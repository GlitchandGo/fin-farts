<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pin Fin!</title>
  <style>
    body {
      background: #222;
      color: #eee;
      font-family: 'Comic Sans MS', Arial, sans-serif;
      text-align: center;
    }
    #selectionScreen {
      display: block;
      margin-top: 60px;
    }
    #gameScreen {
      display: none;
    }
    .fin-title {
      font-size: 3em;
      font-weight: bold;
      color: #0ff;
      margin-bottom: 10px;
      text-shadow: 2px 2px 8px #000;
    }
    .select-label {
      font-size: 1.4em;
      margin-bottom: 18px;
      color: #fff;
    }
    .fin-option {
      display: inline-block;
      margin: 0 30px;
      cursor: pointer;
      border-radius: 14px;
      border: 4px solid transparent;
      transition: border 0.2s;
      box-shadow: 0 4px 18px #0007;
      vertical-align: top;
    }
    .fin-option.selected {
      border: 4px solid #0ff;
      box-shadow: 0 4px 24px #0ff5;
    }
    .fin-img {
      display: block;
      width: 180px;
      height: 180px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 8px;
      background: #111;
    }
    .fin-caption {
      font-size: 1.1em;
      color: #ff0;
      font-weight: bold;
      border-radius: 5px;
      padding: 2px 12px;
    }
    #startBtn {
      margin-top: 30px;
      padding: 12px 36px;
      font-size: 1.3em;
      font-family: 'Comic Sans MS', Arial, sans-serif;
      color: #fff;
      background: #0af;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 3px 14px #0008;
      transition: background 0.2s;
    }
    #startBtn:disabled {
      background: #555;
      cursor: not-allowed;
    }
    /* Game styles (rest unchanged) */
    #gameCanvas {
      background: #444;
      display: block;
      margin: 30px auto;
      border-radius: 10px;
      box-shadow: 0 0 20px #0007;
    }
    .info {
      margin-top: 12px;
      font-size: 1.1em;
      color: #fffc;
    }
    .score {
      margin-top: 10px;
      font-size: 1.4em;
      font-weight: bold;
      color: gold;
      text-shadow: 1px 1px 4px #000;
      min-height: 1.5em;
      transition: opacity 0.3s;
    }
    #totalScore {
      margin-top: 20px;
      font-size: 1.3em;
      color: #0ff;
      font-family: 'Comic Sans MS', sans-serif;
      font-weight: bold;
    }
    #highScore {
      margin-top: 10px;
      font-size: 1.2em;
      color: #ff0;
    }
    #winMessage {
      margin-top: 30px;
      font-size: 2em;
      color: #0f0;
      font-weight: bold;
      display: none;
    }
    #playAgainBtn {
      margin-top: 25px;
      font-size: 1.1em;
      padding: 10px 22px;
      background: #3af;
      color: #fff;
      border: none;
      border-radius: 7px;
      cursor: pointer;
      font-family: 'Comic Sans MS', sans-serif;
      display: none;
      box-shadow: 0 3px 16px #0006;
    }
  </style>
</head>
<body>
  <!-- Selection Screen -->
  <div id="selectionScreen">
    <div class="fin-title">Pin Fin!</div>
    <div class="select-label">Please select your fin</div>
    <div>
      <div class="fin-option" id="schoolFinOption">
        <img src="schoolfin.jpg" alt="School Fin" class="fin-img" />
        <div class="fin-caption">School Fin</div>
      </div>
      <div class="fin-option" id="poolFinOption">
        <img src="fin.jpg" alt="Pool Fin" class="fin-img" />
        <div class="fin-caption">Pool Fin</div>
      </div>
    </div>
    <button id="startBtn" disabled>Start Game</button>
  </div>

  <!-- Game Screen -->
  <div id="gameScreen">
    <canvas id="gameCanvas" width="500" height="500"></canvas>
    <div class="info" id="infoText">Click to stop the dart horizontally!</div>
    <div class="score" id="scoreText"></div>
    <div id="totalScore">Total Score: 0</div>
    <div id="highScore">High Score: 0</div>
    <div id="winMessage">YOU WIN!</div>
    <button id="playAgainBtn">Play Again</button>
  </div>

  <script>
    // Selection Screen Logic
    let selectedFin = null;
    const selectionScreen = document.getElementById('selectionScreen');
    const gameScreen = document.getElementById('gameScreen');
    const schoolFinOption = document.getElementById('schoolFinOption');
    const poolFinOption = document.getElementById('poolFinOption');
    const startBtn = document.getElementById('startBtn');

    schoolFinOption.addEventListener('click', () => {
      selectedFin = "schoolfin.jpg";
      schoolFinOption.classList.add("selected");
      poolFinOption.classList.remove("selected");
      startBtn.disabled = false;
    });

    poolFinOption.addEventListener('click', () => {
      selectedFin = "fin.jpg";
      poolFinOption.classList.add("selected");
      schoolFinOption.classList.remove("selected");
      startBtn.disabled = false;
    });

    startBtn.addEventListener('click', () => {
      selectionScreen.style.display = 'none';
      gameScreen.style.display = 'block';
      startGame();
    });

    // Game Logic
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const infoText = document.getElementById('infoText');
    const scoreText = document.getElementById('scoreText');
    const totalScoreText = document.getElementById('totalScore');
    const highScoreText = document.getElementById('highScore');
    const winMessage = document.getElementById('winMessage');
    const playAgainBtn = document.getElementById('playAgainBtn');

    const boardX = canvas.width/2, boardY = canvas.height/2;
    const doubleOuterR = 170, doubleInnerR = 162;
    const tripleOuterR = 50, tripleInnerR = 42;
    const bull25Radius = 25;
    const bullRadius = 18;
    const boardRadius = 200;

    let bullseyeImage = new Image();
    let dartX = boardX, dartY = boardY;
    let animX = boardX, animY = boardY;
    let phase = 0;
    let directionX = 1;
    let directionY = 1;
    let speedX = 5;
    let speedY = 5;
    let score = 0;
    let turn = 0;
    let maxThrows = 10;
    let highScore = 0;
    let msgTimeout = null;
    let rafId = null;
    let moveMinX = boardX - 180, moveMaxX = boardX + 180;
    let moveMinY = boardY - 180, moveMaxY = boardY + 180;
    const dartNumbers = [20,1,18,4,13,6,10,15,2,17,3,19,7,16,8,11,14,9,12,5];

    function loadHighScore() {
      highScore = parseInt(localStorage.getItem('prank_darts_highscore')) || 0;
      highScoreText.textContent = "High Score: " + highScore;
    }

    function saveHighScore() {
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('prank_darts_highscore', highScore);
        highScoreText.textContent = "High Score: " + highScore;
      }
    }

    function drawDart(x, y) {
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(-Math.PI/2);
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(40, 0);
      ctx.lineWidth = 8;
      ctx.strokeStyle = '#e33';
      ctx.stroke();

      ctx.beginPath();
      ctx.moveTo(40, 0);
      ctx.lineTo(52, -6);
      ctx.lineTo(52, 6);
      ctx.closePath();
      ctx.fillStyle = '#ccc';
      ctx.fill();

      ctx.save();
      ctx.translate(-5, 0);
      ctx.rotate(Math.PI/6);
      ctx.beginPath();
      ctx.moveTo(-12, 0);
      ctx.lineTo(0, -12);
      ctx.lineTo(12, 0);
      ctx.lineTo(0, 12);
      ctx.closePath();
      ctx.fillStyle = '#3af';
      ctx.fill();
      ctx.restore();
      ctx.restore();
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.beginPath();
      ctx.arc(boardX, boardY, boardRadius, 0, 2*Math.PI);
      ctx.fillStyle = "#222";
      ctx.fill();

      ctx.beginPath();
      ctx.arc(boardX, boardY, 135, 0, 2*Math.PI);
      ctx.fillStyle = "#fff";
      ctx.fill();

      ctx.beginPath();
      ctx.arc(boardX, boardY, 127, 0, 2*Math.PI);
      ctx.fillStyle = "#222";
      ctx.fill();

      ctx.beginPath();
      ctx.arc(boardX, boardY, 110, 0, 2*Math.PI);
      ctx.fillStyle = "#0f0";
      ctx.fill();

      ctx.beginPath();
      ctx.arc(boardX, boardY, 85, 0, 2*Math.PI);
      ctx.fillStyle = "#fff";
      ctx.fill();

      ctx.beginPath();
      ctx.arc(boardX, boardY, 77, 0, 2*Math.PI);
      ctx.fillStyle = "#222";
      ctx.fill();

      drawSegments(doubleOuterR, doubleInnerR, ['#0f0', '#f00'], 20);
      drawSegments(tripleOuterR, tripleInnerR, ['#0f0', '#f00'], 20);

      ctx.beginPath();
      ctx.arc(boardX, boardY, bull25Radius, 0, 2*Math.PI);
      ctx.fillStyle = '#0f0';
      ctx.fill();

      drawSegmentLines(20);
      drawScoreNumbers();

      // Bullseye image and border LAST so lines are under it!
      ctx.save();
      ctx.beginPath();
      ctx.arc(boardX, boardY, bullRadius, 0, 2*Math.PI);
      ctx.closePath();
      ctx.clip();
      if (bullseyeImage.complete && bullseyeImage.naturalWidth > 0) {
        ctx.drawImage(
          bullseyeImage,
          boardX - bullRadius,
          boardY - bullRadius,
          bullRadius*2,
          bullRadius*2
        );
      } else {
        ctx.fillStyle = '#f00';
        ctx.fill();
      }
      ctx.restore();

      ctx.beginPath();
      ctx.arc(boardX, boardY, bullRadius, 0, 2*Math.PI);
      ctx.lineWidth = 3;
      ctx.strokeStyle = '#fff';
      ctx.stroke();
    }

    function drawSegments(outerR, innerR, colors, count) {
      for (let i = 0; i < count; i++) {
        const angle = (i * 2 * Math.PI) / count;
        ctx.beginPath();
        ctx.arc(boardX, boardY, outerR, angle, angle + Math.PI*2/count, false);
        ctx.arc(boardX, boardY, innerR, angle + Math.PI*2/count, angle, true);
        ctx.closePath();
        ctx.fillStyle = colors[i % 2];
        ctx.fill();
      }
    }

    function drawSegmentLines(count) {
      ctx.save();
      ctx.translate(boardX, boardY);
      for (let i = 0; i < count; i++) {
        ctx.rotate(Math.PI*2/count);
        ctx.beginPath();
        ctx.moveTo(0, -boardRadius);
        ctx.lineTo(0, boardRadius);
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 1.2;
        ctx.stroke();
      }
      ctx.restore();
    }

    function drawScoreNumbers() {
      ctx.save();
      ctx.translate(boardX, boardY);
      for (let i = 0; i < 20; i++) {
        const angle = ((i-4) * 2 * Math.PI) / 20;
        const num = dartNumbers[i];
        ctx.save();
        ctx.rotate(angle);
        ctx.font = 'bold 26px Comic Sans MS, sans-serif';
        ctx.fillStyle = '#ff0';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(num, 0, -185);
        ctx.restore();
      }
      ctx.restore();
    }

    function gameLoop() {
      drawBoard();
      if (phase === 0) {
        animX += speedX * directionX;
        if (animX < moveMinX || animX > moveMaxX) directionX *= -1;
      } else if (phase === 1) {
        animY += speedY * directionY;
        if (animY < moveMinY || animY > moveMaxY) directionY *= -1;
      }
      drawDart(animX, animY);
      if (phase !== 2 && phase !== 3) rafId = requestAnimationFrame(gameLoop);
    }

    function stopAnimation() {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = null;
    }

    canvas.addEventListener('click', () => {
      if (phase === 0) {
        dartX = animX;
        directionY = 1;
        phase = 1;
        stopAnimation();
        infoText.textContent = 'Now click to stop vertically!';
        rafId = requestAnimationFrame(gameLoop);
      } else if (phase === 1) {
        dartY = animY;
        phase = 2;
        stopAnimation();
        throwDart();
      }
    });

    function throwDart() {
      infoText.textContent = 'You threw the dart!';
      drawBoard();
      drawDart(dartX, dartY);

      const tipLength = 40;
      const tipAngle = -Math.PI/2;
      const tipX = dartX + tipLength * Math.cos(tipAngle);
      const tipY = dartY + tipLength * Math.sin(tipAngle);
      const dx = tipX - boardX;
      const dy = tipY - boardY;
      const dist = Math.sqrt(dx*dx + dy*dy);

      let hitScore = 0;
      let hitText = "";

      if (dist <= bullRadius) {
        hitScore = 50;
        hitText = "You killed fin! (+50)";
      } else if (dist <= bull25Radius) {
        hitScore = 25;
        hitText = "Outer Bull! (+25)";
      } else if (dist >= tripleInnerR && dist <= tripleOuterR) {
        hitScore = getSegmentScore(tipX, tipY) * 3;
        hitText = `Triple ${getSegmentScore(tipX, tipY)}! (+${hitScore})`;
      } else if (dist >= doubleInnerR && dist <= doubleOuterR) {
        hitScore = getSegmentScore(tipX, tipY) * 2;
        hitText = `Double ${getSegmentScore(tipX, tipY)}! (+${hitScore})`;
      } else if (dist <= boardRadius) {
        hitScore = getSegmentScore(tipX, tipY);
        hitText = `Single ${hitScore}! (+${hitScore})`;
      } else {
        hitText = "Miss!";
      }
      score += hitScore;
      scoreText.textContent = hitText;
      totalScoreText.textContent = "Total Score: " + score;

      turn++;
      saveHighScore();

      clearTimeout(msgTimeout);
      msgTimeout = setTimeout(() => {
        scoreText.textContent = "";
        if (turn < maxThrows) {
          animX = boardX;
          animY = boardY;
          directionX = 1;
          directionY = 1;
          phase = 0;
          infoText.textContent = 'Click to stop the dart horizontally!';
          rafId = requestAnimationFrame(gameLoop);
        } else {
          endGame();
        }
      }, 2500);
    }

    function endGame() {
      phase = 3;
      winMessage.style.display = "block";
      playAgainBtn.style.display = "inline-block";
      infoText.textContent = '';
    }

    playAgainBtn.onclick = () => {
      score = 0;
      turn = 0;
      totalScoreText.textContent = "Total Score: " + score;
      scoreText.textContent = "";
      winMessage.style.display = "none";
      playAgainBtn.style.display = "none";
      infoText.textContent = 'Click to stop the dart horizontally!';
      animX = boardX;
      animY = boardY;
      directionX = 1;
      directionY = 1;
      phase = 0;
      rafId = requestAnimationFrame(gameLoop);
    };

    function getSegmentScore(x, y) {
      const angle = Math.atan2(y - boardY, x - boardX);
      let sector = Math.round(((angle + Math.PI)/(2*Math.PI))*20) % 20;
      return dartNumbers[sector];
    }

    function startGame() {
      bullseyeImage = new Image();
      bullseyeImage.src = selectedFin;
      bullseyeImage.onload = () => {
        loadHighScore();
        animX = boardX;
        animY = boardY;
        directionX = 1;
        directionY = 1;
        phase = 0;
        score = 0;
        turn = 0;
        winMessage.style.display = "none";
        playAgainBtn.style.display = "none";
        infoText.textContent = 'Click to stop the dart horizontally!';
        totalScoreText.textContent = "Total Score: " + score;
        scoreText.textContent = "";
        rafId = requestAnimationFrame(gameLoop);
      };
      bullseyeImage.onerror = () => {
        loadHighScore();
        animX = boardX;
        animY = boardY;
        directionX = 1;
        directionY = 1;
        phase = 0;
        score = 0;
        turn = 0;
        winMessage.style.display = "none";
        playAgainBtn.style.display = "none";
        infoText.textContent = 'Click to stop the dart horizontally!';
        totalScoreText.textContent = "Total Score: " + score;
        scoreText.textContent = "";
        rafId = requestAnimationFrame(gameLoop);
      };
    }
  </script>
</body>
</html>
